import type { PCBDesignAnalysis } from "../components/PCBVisualization/types";

function generateWaveform(
  points: number,
  noise: number,
  frequency: number,
): number[] {
  const waveform: number[] = [];
  for (let i = 0; i < points; i++) {
    const t = i / points;
    const signal = Math.sin(t * Math.PI * 2 * frequency);
    const noiseValue = (Math.random() - 0.5) * noise;
    waveform.push(signal + noiseValue);
  }
  return waveform;
}

export const edaPcbMockData: PCBDesignAnalysis = {
  board: {
    id: "stm32-dev-board-v2",
    name: "STM32F4 Development Board",
    width: 80,
    height: 60,
    layers: ["top", "L2_GND", "L3_PWR", "bottom"],
    components: [
      {
        id: "u1",
        designator: "U1",
        name: "STM32F446RET6",
        package: "LQFP-64",
        value: null,
        position: { x: 40, y: 30 },
        rotation: 0,
        layer: "top",
        width: 12,
        height: 12,
        isCritical: true,
        pins: [
          {
            id: "u1-1",
            name: "PA0",
            position: { x: 34, y: 25 },
            netId: "GPIO0",
          },
          {
            id: "u1-2",
            name: "PA1",
            position: { x: 34, y: 27 },
            netId: "GPIO1",
          },
          {
            id: "u1-3",
            name: "PA2",
            position: { x: 34, y: 29 },
            netId: "USART_TX",
          },
          {
            id: "u1-4",
            name: "PA3",
            position: { x: 34, y: 31 },
            netId: "USART_RX",
          },
          {
            id: "u1-17",
            name: "USB_DM",
            position: { x: 46, y: 25 },
            netId: "USB_DM",
          },
          {
            id: "u1-18",
            name: "USB_DP",
            position: { x: 46, y: 27 },
            netId: "USB_DP",
          },
          {
            id: "u1-vdd",
            name: "VDD",
            position: { x: 40, y: 24 },
            netId: "VCC3V3",
          },
          {
            id: "u1-gnd",
            name: "GND",
            position: { x: 40, y: 36 },
            netId: "GND",
          },
        ],
      },
      {
        id: "u2",
        designator: "U2",
        name: "LDO 3.3V",
        package: "SOT-223",
        value: "AMS1117-3.3",
        position: { x: 15, y: 15 },
        rotation: 0,
        layer: "top",
        width: 6,
        height: 3,
        isCritical: true,
        pins: [
          { id: "u2-1", name: "VIN", position: { x: 12, y: 15 }, netId: "VIN" },
          {
            id: "u2-2",
            name: "GND",
            position: { x: 15, y: 16.5 },
            netId: "GND",
          },
          {
            id: "u2-3",
            name: "VOUT",
            position: { x: 18, y: 15 },
            netId: "VCC3V3",
          },
        ],
      },
      {
        id: "j1",
        designator: "J1",
        name: "USB-C Connector",
        package: "USB-C-16P",
        value: null,
        position: { x: 10, y: 30 },
        rotation: 90,
        layer: "top",
        width: 8,
        height: 12,
        isCritical: true,
        pins: [
          {
            id: "j1-1",
            name: "VBUS",
            position: { x: 6, y: 26 },
            netId: "VBUS",
          },
          {
            id: "j1-dm",
            name: "DM",
            position: { x: 6, y: 30 },
            netId: "USB_DM",
          },
          {
            id: "j1-dp",
            name: "DP",
            position: { x: 6, y: 32 },
            netId: "USB_DP",
          },
          {
            id: "j1-gnd",
            name: "GND",
            position: { x: 6, y: 34 },
            netId: "GND",
          },
        ],
      },
      {
        id: "y1",
        designator: "Y1",
        name: "Crystal 8MHz",
        package: "HC49",
        value: "8MHz",
        position: { x: 55, y: 25 },
        rotation: 0,
        layer: "top",
        width: 5,
        height: 2,
        pins: [
          {
            id: "y1-1",
            name: "IN",
            position: { x: 52.5, y: 25 },
            netId: "OSC_IN",
          },
          {
            id: "y1-2",
            name: "OUT",
            position: { x: 57.5, y: 25 },
            netId: "OSC_OUT",
          },
        ],
      },
      {
        id: "c1",
        designator: "C1",
        name: "Capacitor",
        package: "0805",
        value: "22pF",
        position: { x: 52, y: 20 },
        rotation: 0,
        layer: "top",
        width: 2,
        height: 1.25,
        pins: [
          {
            id: "c1-1",
            name: "1",
            position: { x: 51, y: 20 },
            netId: "OSC_IN",
          },
          { id: "c1-2", name: "2", position: { x: 53, y: 20 }, netId: "GND" },
        ],
      },
      {
        id: "c2",
        designator: "C2",
        name: "Capacitor",
        package: "0805",
        value: "22pF",
        position: { x: 58, y: 20 },
        rotation: 0,
        layer: "top",
        width: 2,
        height: 1.25,
        pins: [
          {
            id: "c2-1",
            name: "1",
            position: { x: 57, y: 20 },
            netId: "OSC_OUT",
          },
          { id: "c2-2", name: "2", position: { x: 59, y: 20 }, netId: "GND" },
        ],
      },
      {
        id: "c3",
        designator: "C3",
        name: "Capacitor",
        package: "0805",
        value: "100nF",
        position: { x: 30, y: 25 },
        rotation: 0,
        layer: "top",
        width: 2,
        height: 1.25,
        pins: [
          {
            id: "c3-1",
            name: "1",
            position: { x: 29, y: 25 },
            netId: "VCC3V3",
          },
          { id: "c3-2", name: "2", position: { x: 31, y: 25 }, netId: "GND" },
        ],
      },
      {
        id: "r1",
        designator: "R1",
        name: "Resistor",
        package: "0603",
        value: "10K",
        position: { x: 60, y: 35 },
        rotation: 0,
        layer: "top",
        width: 1.6,
        height: 0.8,
        pins: [
          {
            id: "r1-1",
            name: "1",
            position: { x: 59.2, y: 35 },
            netId: "VCC3V3",
          },
          {
            id: "r1-2",
            name: "2",
            position: { x: 60.8, y: 35 },
            netId: "NRST",
          },
        ],
      },
      {
        id: "sw1",
        designator: "SW1",
        name: "Reset Button",
        package: "TACT-6x6",
        value: null,
        position: { x: 65, y: 35 },
        rotation: 0,
        layer: "top",
        width: 6,
        height: 6,
        pins: [
          { id: "sw1-1", name: "1", position: { x: 62, y: 32 }, netId: "NRST" },
          { id: "sw1-2", name: "2", position: { x: 68, y: 32 }, netId: "GND" },
        ],
      },
      {
        id: "led1",
        designator: "LED1",
        name: "Status LED",
        package: "0805",
        value: "Green",
        position: { x: 70, y: 15 },
        rotation: 0,
        layer: "top",
        width: 2,
        height: 1.25,
        pins: [
          {
            id: "led1-a",
            name: "A",
            position: { x: 69, y: 15 },
            netId: "LED_STATUS",
          },
          { id: "led1-k", name: "K", position: { x: 71, y: 15 }, netId: "GND" },
        ],
      },
      {
        id: "j2",
        designator: "J2",
        name: "SWD Header",
        package: "Header-2x5",
        value: null,
        position: { x: 70, y: 50 },
        rotation: 0,
        layer: "top",
        width: 5,
        height: 12.7,
        pins: [
          {
            id: "j2-1",
            name: "VCC",
            position: { x: 68.7, y: 45 },
            netId: "VCC3V3",
          },
          {
            id: "j2-2",
            name: "SWDIO",
            position: { x: 71.3, y: 45 },
            netId: "SWDIO",
          },
          {
            id: "j2-3",
            name: "GND",
            position: { x: 68.7, y: 47.5 },
            netId: "GND",
          },
          {
            id: "j2-4",
            name: "SWCLK",
            position: { x: 71.3, y: 47.5 },
            netId: "SWCLK",
          },
        ],
      },
    ],
    traces: [
      {
        id: "t1",
        netId: "USB_DM",
        netName: "USB_DM",
        layer: "top",
        points: [
          { x: 6, y: 30 },
          { x: 20, y: 30 },
          { x: 25, y: 25 },
          { x: 34, y: 25 },
        ],
        width: 0.3,
        status: "routed",
      },
      {
        id: "t2",
        netId: "USB_DP",
        netName: "USB_DP",
        layer: "top",
        points: [
          { x: 6, y: 32 },
          { x: 18, y: 32 },
          { x: 23, y: 27 },
          { x: 34, y: 27 },
        ],
        width: 0.3,
        status: "routed",
      },
      {
        id: "t3",
        netId: "VCC3V3",
        netName: "VCC3V3",
        layer: "L3_PWR",
        points: [
          { x: 18, y: 15 },
          { x: 30, y: 15 },
          { x: 40, y: 24 },
        ],
        width: 0.5,
        status: "routed",
      },
      {
        id: "t4",
        netId: "OSC_IN",
        netName: "OSC_IN",
        layer: "top",
        points: [
          { x: 52.5, y: 25 },
          { x: 51, y: 25 },
          { x: 51, y: 30 },
          { x: 46, y: 30 },
        ],
        width: 0.2,
        status: "routed",
      },
      {
        id: "t5",
        netId: "OSC_OUT",
        netName: "OSC_OUT",
        layer: "top",
        points: [
          { x: 57.5, y: 25 },
          { x: 59, y: 25 },
          { x: 59, y: 32 },
          { x: 46, y: 32 },
        ],
        width: 0.2,
        status: "routed",
      },
      {
        id: "t6",
        netId: "SWDIO",
        netName: "SWDIO",
        layer: "bottom",
        points: [
          { x: 71.3, y: 45 },
          { x: 60, y: 45 },
          { x: 50, y: 38 },
        ],
        width: 0.25,
        status: "routed",
      },
      {
        id: "t7",
        netId: "SWCLK",
        netName: "SWCLK",
        layer: "bottom",
        points: [
          { x: 71.3, y: 47.5 },
          { x: 58, y: 47.5 },
          { x: 48, y: 40 },
        ],
        width: 0.25,
        status: "routed",
      },
    ],
    vias: [
      { id: "v1", netId: "VCC3V3", position: { x: 30, y: 15 }, size: 0.8 },
      { id: "v2", netId: "GND", position: { x: 35, y: 35 }, size: 0.8 },
      { id: "v3", netId: "GND", position: { x: 45, y: 35 }, size: 0.8 },
      { id: "v4", netId: "SWDIO", position: { x: 50, y: 38 }, size: 0.6 },
      { id: "v5", netId: "SWCLK", position: { x: 48, y: 40 }, size: 0.6 },
      { id: "v6", netId: "VCC3V3", position: { x: 60, y: 35 }, size: 0.8 },
    ],
  },
  drcViolations: [
    {
      id: "drc-1",
      type: "clearance",
      severity: "error",
      location: { x: 23, y: 28 },
      description:
        "Trace clearance violation: USB_DM to USB_DP spacing is 0.12mm (min: 0.15mm)",
      affectedObjects: ["t1", "t2"],
      suggestedFix:
        "Increase trace spacing to 0.15mm or route USB differential pair with proper impedance control",
    },
    {
      id: "drc-2",
      type: "impedance",
      severity: "warning",
      location: { x: 20, y: 30 },
      description:
        "USB differential pair impedance mismatch: 85Ω measured vs 90Ω target",
      affectedObjects: ["t1", "t2"],
      suggestedFix:
        "Adjust trace width to 0.35mm or modify layer stackup for correct impedance",
    },
    {
      id: "drc-3",
      type: "length_match",
      severity: "warning",
      location: { x: 55, y: 28 },
      description:
        "Crystal traces length mismatch: OSC_IN 12.5mm vs OSC_OUT 15.2mm (max diff: 2mm)",
      affectedObjects: ["t4", "t5"],
      suggestedFix: "Add serpentine routing to OSC_IN trace to match lengths",
    },
    {
      id: "drc-4",
      type: "annular_ring",
      severity: "info",
      location: { x: 50, y: 38 },
      description:
        "Via annular ring is 0.15mm (recommended: 0.2mm for reliability)",
      affectedObjects: ["v4"],
      suggestedFix: "Increase via pad size or reduce drill diameter",
    },
  ],
  signalIntegrity: [
    {
      netId: "USB_DM",
      netName: "USB_DM",
      impedance: 85,
      impedanceTarget: 90,
      passed: false,
      waveform: generateWaveform(100, 0.15, 3),
      issues: ["Impedance 5.5% below target", "Consider adjusting trace width"],
    },
    {
      netId: "USB_DP",
      netName: "USB_DP",
      impedance: 86,
      impedanceTarget: 90,
      passed: false,
      waveform: generateWaveform(100, 0.12, 3),
      issues: ["Impedance 4.4% below target"],
    },
    {
      netId: "OSC_IN",
      netName: "OSC_IN",
      impedance: 52,
      impedanceTarget: 50,
      passed: true,
      waveform: generateWaveform(100, 0.05, 8),
      issues: [],
    },
    {
      netId: "OSC_OUT",
      netName: "OSC_OUT",
      impedance: 51,
      impedanceTarget: 50,
      passed: true,
      waveform: generateWaveform(100, 0.06, 8),
      issues: [],
    },
    {
      netId: "SWDIO",
      netName: "SWDIO",
      impedance: 48,
      impedanceTarget: 50,
      passed: true,
      waveform: generateWaveform(100, 0.08, 2),
      issues: [],
    },
    {
      netId: "SWCLK",
      netName: "SWCLK",
      impedance: 49,
      impedanceTarget: 50,
      passed: true,
      waveform: generateWaveform(100, 0.07, 2),
      issues: [],
    },
  ],
  aiSuggestions: [
    {
      id: "ai-1",
      type: "routing",
      priority: "high",
      title: "USB Differential Pair Routing",
      description:
        "USB D+/D- traces require matched impedance routing with proper spacing",
      reasoning:
        "Analysis detected the USB differential pair is routed with inconsistent spacing and trace widths. USB 2.0 Full Speed requires 90Ω ±10% differential impedance. Current routing shows 85Ω which may cause signal integrity issues and USB enumeration failures.",
      affectedComponents: ["U1", "J1"],
      confidence: 0.92,
      actionLabel: "Auto-fix",
    },
    {
      id: "ai-2",
      type: "placement",
      priority: "high",
      title: "Crystal Placement Optimization",
      description:
        "Move Y1 crystal closer to MCU for improved signal integrity",
      reasoning:
        "The 8MHz crystal is currently 15mm from the STM32 oscillator pins. For optimal performance, crystal should be within 10mm of the MCU. Long traces increase susceptibility to EMI and may cause clock jitter affecting USB timing and UART baud rates.",
      affectedComponents: ["U1", "Y1", "C1", "C2"],
      confidence: 0.88,
      actionLabel: "Suggest Move",
    },
    {
      id: "ai-3",
      type: "drc",
      priority: "medium",
      title: "Add Ground Via Stitching",
      description: "Insufficient ground via density near high-speed signals",
      reasoning:
        "USB and clock signals benefit from nearby ground return paths. Adding ground vias every 3mm along the USB differential pair will reduce EMI emissions and improve signal quality. Current design has 8mm gaps between ground vias.",
      affectedComponents: ["t1", "t2"],
      confidence: 0.85,
      actionLabel: "Add Vias",
    },
    {
      id: "ai-4",
      type: "thermal",
      priority: "medium",
      title: "LDO Thermal Management",
      description: "Add thermal vias under U2 voltage regulator",
      reasoning:
        "The AMS1117-3.3 LDO can dissipate up to 1W when dropping from 5V to 3.3V at 500mA. Adding 4-6 thermal vias under the tab pad will improve heat dissipation to the ground plane and prevent thermal shutdown during high current draw.",
      affectedComponents: ["U2"],
      confidence: 0.79,
      actionLabel: "Add Thermal Vias",
    },
    {
      id: "ai-5",
      type: "signal_integrity",
      priority: "low",
      title: "Decoupling Capacitor Placement",
      description: "C3 bypass capacitor could be positioned closer to VDD pin",
      reasoning:
        "The 100nF decoupling capacitor is 5mm from the MCU VDD pin. Moving it within 2mm will reduce power supply noise and improve high-frequency decoupling. This is especially important for the internal ADC reference stability.",
      affectedComponents: ["U1", "C3"],
      confidence: 0.72,
    },
  ],
  summary: {
    componentCount: 11,
    netCount: 14,
    routingCompletion: 87,
    drcErrors: 1,
    drcWarnings: 3,
    siPassed: 4,
    siFailed: 2,
  },
};
